(function(){"use strict";var t={2185:function(t,e,i){var n=i(3751),a=i(641);function o(t,e,i,n,o,s){const r=(0,a.g2)("AnimatedBacteria"),l=(0,a.g2)("SimulationControls");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",null,[(0,a.bF)(r,{IC50:o.animationParams.IC50,IC50_initial:o.animationParams.IC50_initial,growthRate:o.animationParams.growthRate,adaptationRate:o.animationParams.adaptationRate,currentDose:o.animationParams.currentDose},null,8,["IC50","IC50_initial","growthRate","adaptationRate","currentDose"])]),(0,a.Lk)("div",null,[(0,a.bF)(l,{onUpdateParams:s.updateParams},null,8,["onUpdateParams"])])],64)}var s=i(33);const r=(0,a.Lk)("h1",null,"Evolution Experiment Simulation",-1),l={class:"slider-container",style:{marginBottom:"10px"}},u=["max"],h=(0,a.Lk)("div",{id:"plotDiv"},null,-1),d={class:"settings-container"},m={class:"settings-block"},c=(0,a.Lk)("h2",null,"Culture Control Parameters",-1),p={class:"settings-table"},g=["onUpdate:modelValue","min","max","step"],f=["onUpdate:modelValue"],y={class:"settings-block"},v=(0,a.Lk)("h2",null,"Culture Growth Model Parameters",-1),C={class:"settings-table"},D=["onUpdate:modelValue"],S={class:"outcome"},x=(0,a.Lk)("h2",null,"Outcome",-1),b=(0,a.Lk)("label",null,"Duration [h]: ",-1),I=(0,a.Lk)("br",null,null,-1),A=(0,a.Lk)("div",{id:"adaptation-rate-plot"},null,-1),k=(0,a.Lk)("div",{id:"mu-plot"},null,-1);function R(t,e,i,o,R,w){return(0,a.uX)(),(0,a.CE)(a.FK,null,[r,(0,a.Lk)("div",l,[(0,a.Lk)("button",{onClick:e[0]||(e[0]=(...t)=>w.togglePlay&&w.togglePlay(...t)),style:(0,s.Tr)({backgroundColor:R.isPlaying?"#E74C3C":"#3498DB"})},(0,s.v_)(R.isPlaying?"Pause":"Play"),5),(0,a.bo)((0,a.Lk)("input",{type:"range",id:"timepoint-slider",min:0,max:R.maxTimepoints,"onUpdate:modelValue":e[1]||(e[1]=t=>R.selectedTimepoint=t)},null,8,u),[[n.Jo,R.selectedTimepoint]])]),h,(0,a.Lk)("div",d,[(0,a.Lk)("div",m,[c,(0,a.Lk)("table",p,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(R.updaterSettings,((t,e)=>((0,a.uX)(),(0,a.CE)("tr",{key:"updater-"+e},[(0,a.Lk)("td",null,(0,s.v_)(e),1),(0,a.Lk)("td",null,[R.updaterSettings_bounds[e]?(0,a.bo)(((0,a.uX)(),(0,a.CE)("input",{key:0,"onUpdate:modelValue":t=>R.updaterSettings[e]=t,type:"range",min:R.updaterSettings_bounds[e][0],max:R.updaterSettings_bounds[e][1],step:R.updaterSettings_bounds[e][2]||.1},null,8,g)),[[n.Jo,R.updaterSettings[e],void 0,{number:!0}]]):(0,a.bo)(((0,a.uX)(),(0,a.CE)("input",{key:1,"onUpdate:modelValue":t=>R.updaterSettings[e]=t,type:"number"},null,8,f)),[[n.Jo,R.updaterSettings[e],void 0,{number:!0}]]),(0,a.eW)(" "+(0,s.v_)(R.updaterSettings[e]),1)])])))),128))])]),(0,a.Lk)("div",y,[v,(0,a.Lk)("table",C,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(R.modelSettingsKeys,(t=>((0,a.uX)(),(0,a.CE)("tr",{key:"model-"+t},[(0,a.Lk)("td",null,(0,s.v_)(t),1),(0,a.Lk)("td",null,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":e=>R.modelSettings[t]=e,type:"number"},null,8,D),[[n.Jo,R.modelSettings[t],void 0,{number:!0}]])])])))),128))])]),(0,a.Lk)("div",S,[x,(0,a.Lk)("p",null,"Volume Used: "+(0,s.v_)(R.volumeUsed)+" ml",1),(0,a.Lk)("p",null,[(0,a.eW)("IC50 Fold Change: "),(0,a.Lk)("b",null,(0,s.v_)(R.ic50FoldChange),1)]),(0,a.Lk)("p",null,[(0,a.eW)("Volume per IC50 Doubling: "),(0,a.Lk)("b",null,(0,s.v_)(R.volumePerIC50Doubling),1),(0,a.eW)(" ml")]),(0,a.Lk)("p",null,[(0,a.eW)("Time per IC50 Doubling: "),(0,a.Lk)("b",null,(0,s.v_)(R.timePerIC50Doubling),1),(0,a.eW)(" hours")]),b,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>R.simulationHours=t),type:"number"},null,512),[[n.Jo,R.simulationHours,void 0,{number:!0}]]),I,(0,a.Lk)("button",{class:"run-button",onClick:e[3]||(e[3]=(...t)=>w.runSimulation&&w.runSimulation(...t))},"Recalculate")])]),A,k],64)}i(4114);function w(t,e,i,n,a){const o=a*n,s=Math.log(9)/(a-o);return e+i/(1+Math.exp(-s*(a-t)))}function M(t,e,i,n){const a=Math.log(19)/(.5*n),o=i-e,s=t/(1+Math.exp(-a*o));return s}function T(t,e,i,n,a,o,s){const r=w(t,0,i,n,a);return e+r*(1-o/s)}function P(t,e,i,n,a){const o=i*n,s=-Math.log(a)/Math.pow(o-i,2),r=e*Math.exp(-s*Math.pow(t-i,2));return r}class L{constructor(t={}){const e={doseInitialization:1,odDilutionThreshold:.3,dilutionFactor:1.6,dilutionNumberFirstDrugAddition:2,doseFirstDrugAddition:3,doseIncreaseFactor:2,doseIncreaseAmount:0,thresholdOdMinIncreaseStress:.1,thresholdGrowthRateIncreaseStress:.15,thresholdGrowthRateDecreaseStress:-.1,delayDilutionMaxHours:4,delayStressIncreaseMinGenerations:2,volumeVial:12,pump1StockDrugConcentration:0,pump2StockDrugConcentration:100};Object.assign(this,e,t)}rescueIfNecessary(t){if(t.doses.length<1)return;const e=t.doses[t.doses.length-1][1],i=(t.timeCurrent-e)/36e5;i<this.delayDilutionMaxHours||t.growthRate>this.thresholdGrowthRateDecreaseStress||(console.log("Rescue dilution"),t.diluteCulture(0,this.dilutionFactor))}calculateIncreasedDose(t){const e=t*this.doseIncreaseFactor+this.doseIncreaseAmount;return Math.round(1e3*e)/1e3}diluteToWashIfNeeded(t){const e=.1,i=1.2,n=e,a=this.volumeVial*i-n,o=t.doses.length>0?t.doses[t.doses.length-1][0]:0,s=this.volumeVial+a+n,r=(this.volumeVial*o+a*this.pump1StockDrugConcentration+n*this.pump2StockDrugConcentration)/s;if(!t.population||0===t.population.length)return;if(this.delayDilutionMaxHours<0)return;const l=t.doses.length>0?t.doses[t.doses.length-1][1]:t.firstOdTimestamp,u=(t.timeCurrent-l)/36e5;u>this.delayDilutionMaxHours&&(console.log("Washing dilution, target dose",r,"time_current",t.timeCurrent),t.diluteCulture(r,i))}isTimeToIncreaseDose(t){let e=!0;if([this.thresholdGrowthRateIncreaseStress,this.delayStressIncreaseMinGenerations,this.doseIncreaseFactor,this.dilutionNumberFirstDrugAddition].includes(-1)&&(e=!1),t.population[t.population.length-1][0]<this.thresholdOdMinIncreaseStress&&(e=!1),t.growthRate<this.thresholdGrowthRateIncreaseStress&&(e=!1),-1!==this.delayStressIncreaseMinGenerations&&t.doses.length>0){const i=t.doses.reduceRight(((t,e,i,n)=>null!==t?t:i>0&&e[0]!==n[i-1][0]?e[1]:null),null),n=t.generations.find((t=>t[1]>=i))[0],a=t.generations[t.generations.length-1][0]-n;a<=this.delayStressIncreaseMinGenerations&&(e=!1)}return t.doses.length<this.dilutionNumberFirstDrugAddition&&(e=!1),e}isTooEarlyForRegularDilution(t){if(0===t.population.length)return!0;if(t.doses.length>0){const e=t.population[t.population.length-1][1],i=t.doses[t.doses.length-1][1],n=1;if(e<i+6e4*n)return!0}return!1}isTimeToDilute(t){if(-1!==this.odDilutionThreshold&&t.population[t.population.length-1][0]>=this.odDilutionThreshold)return!0;if(-1!==this.delayDilutionMaxHours)if(t.doses.length>0){const e=(t.timeCurrent-t.doses[t.doses.length-1][1])/36e5;if(e>this.delayDilutionMaxHours)return!0}else{const e=(t.timeCurrent-t.firstOdTimestamp)/36e5;if(e>this.delayDilutionMaxHours)return!0}return!1}update(t){if(this.doseInitialization>0&&0===t.doses.length)t.diluteCulture(this.doseInitialization);else if(!this.isTooEarlyForRegularDilution(t)){if(this.isTimeToDilute(t)){let e;return this.dilutionNumberFirstDrugAddition<0?e=this.pump1StockDrugConcentration:t.doses.length===this.dilutionNumberFirstDrugAddition-1?e=this.doseFirstDrugAddition:(e=t.doses.length>0?t.doses[t.doses.length-1][0]:this.pump1StockDrugConcentration,t.doses.length>this.dilutionNumberFirstDrugAddition&&this.isTimeToIncreaseDose(t)&&(e=this.calculateIncreasedDose(t.doses[t.doses.length-1][0]))),void t.diluteCulture(e)}this.rescueIfNecessary(t),this.diluteToWashIfNeeded(t)}}}var F=L;class E{constructor(t={}){this.defaults={initialPopulation:.01,doublingTimeMins:20,carryingCapacity:.9,muMin:-.1,ic50Initial:5,ic10Ic50Ratio:.5,doseEffectiveSlopeWidthMins:120,timeLagDrugEffectMins:30,adaptationRateMax:.08,adaptationRateIc10Ic50Ratio:.8,generationCurrent:0,drugConcentration:0,effectiveDose:0,timeCurrent:new Date,updater:new F},Object.assign(this,this.defaults,t),this.muMax=Math.log(2)/(this.doublingTimeMins/60),this.initializeModelState()}initializeModelState(){this.timeCurrent=new Date,this.population=[],this.generations=[],this.doses=[],this.effectiveDoses=[],this.ic50s=[[this.ic50Initial,this.timeCurrent]],this.effectiveGrowthRates=[],this.adaptationRates=[]}get growthRate(){return this.effectiveGrowthRates.length?this.effectiveGrowthRates[this.effectiveGrowthRates.length-1][0]:0}calculateEffectiveDose(t){if(0===this.effectiveDoses.length){let t=this.doses.length>0?this.doses[0][0]:0;this.effectiveDoses.push([t,this.timeCurrent])}let e=this.effectiveDoses[0][0];const i=0;if(this.doses.length>1){const n=[i].concat(this.doses.map((t=>t[0]))),a=this.doses.map((t=>t[1]));for(let i=1;i<n.length;i++){let o=n[i]-n[i-1];if(0===o)continue;let s=(t-a[i-1])/36e5;e+=M(o,this.timeLagDrugEffectMins/60,s,this.doseEffectiveSlopeWidthMins/60)}}return e}simulateExperimentMinute(){let t=this.calculateEffectiveDose(this.timeCurrent);this.effectiveDoses.push([t,this.timeCurrent]);let e=0;if(this.population.length&&(e=T(t,this.muMin,this.muMax,this.ic10Ic50Ratio,this.ic50s[this.ic50s.length-1][0],this.population[this.population.length-1][0],this.carryingCapacity),this.effectiveGrowthRates.push([e,this.timeCurrent])),t>0){let e=P(t,this.adaptationRateMax,this.ic50s[this.ic50s.length-1][0],this.ic10Ic50Ratio,this.adaptationRateIc10Ic50Ratio);this.adaptationRates.push([e,this.timeCurrent]);let i=this.ic50s[this.ic50s.length-1][0]*Math.exp(e/60);this.ic50s.push([i,this.timeCurrent])}else this.adaptationRates.push([0,this.timeCurrent]),this.ic50s.push([this.ic50Initial,this.timeCurrent]);let i=this.population.length?this.population[this.population.length-1][0]*Math.exp(e/60):this.initialPopulation;this.population.push([i,this.timeCurrent]),this.updater.update(this)}diluteCulture(t=0,e=1.6){e=this.updater.dilutionFactor;const i=this.updater.volumeVial*(e-1),n=this.updater.pump2StockDrugConcentration,a=this.updater.pump1StockDrugConcentration,o=this.drugConcentration,s=this.updater.volumeVial,r=(o*s+n*i)/(s+i),l=(o*s+a*i)/(s+i);t=Math.min(t,r),t=Math.max(t,l);const u=t-o;if(this.drugConcentration+=u,this.doses.push([this.drugConcentration,this.timeCurrent]),this.population.length>0){const t=this.population[this.population.length-1][0]/e;this.population[this.population.length-1]=[t,this.timeCurrent]}let h=Math.log2(e);this.generations.length>0&&(h+=this.generations[this.generations.length-1][0]),this.generations.push([h,this.timeCurrent])}simulateExperiment(t=48){for(let e=1;e<=60*t;e++)this.timeCurrent=new Date(this.timeCurrent.getTime()+6e4),this.simulateExperimentMinute()}getSimulationEfficiency(){const t=this.updater.dilutionFactor,e=this.updater.volumeVial*(t-1),i=this.doses.length*e,n=this.ic50s[this.ic50s.length-1][0]/this.ic50s[0][0],a=(this.population[this.population.length-1][1]-this.population[0][1])/36e5;return[i,a,n]}}var G=E,_=i(4708),$=i.n(_);class z{constructor(t=null){this.model=t}plot_mu(){const t=Array.from({length:1e3},((t,e)=>.1*e)),e=this.model.muMin,i=this.model.muMax,n=this.model.ic50Initial,a=this.model.ic10Ic50Ratio,o=t.map((t=>T(t,e,i,a,n,.5,1))),s=[{x:t,y:o,type:"scatter",mode:"lines",line:{color:"blue"}}],r={title:"Effect of Drug Dose on Growth Rate",xaxis:{title:"Effective Drug Dose"},yaxis:{title:"Growth Rate [1/hour]"}};$().newPlot("mu-plot",s,r)}plot_adaptation_rate(){const t=Array.from({length:1e3},((t,e)=>.1*e)),e=this.model.adaptationRateMax,i=this.model.ic50Initial,n=this.model.ic10Ic50Ratio,a=this.model.adaptationRateIc10Ic50Ratio,o=t.map((t=>P(t,e,i,n,a))),s=[{x:t,y:o,type:"scatter",mode:"lines",line:{color:"black"}}],r={title:"Effect of Antibiotic Dose on Adaptation Rate",xaxis:{title:"Effective Antibiotic Dose"},yaxis:{title:"Adaptation Rate [1/hour]"}};$().newPlot("adaptation-rate-plot",s,r)}}var O={data(){return{updaterSettings:{doseInitialization:1,odDilutionThreshold:.3,dilutionFactor:1.6,dilutionNumberFirstDrugAddition:2,doseFirstDrugAddition:3,doseIncreaseFactor:2,doseIncreaseAmount:0,thresholdOdMinIncreaseStress:.1,thresholdGrowthRateIncreaseStress:.15,thresholdGrowthRateDecreaseStress:-.1,delayDilutionMaxHours:4,delayStressIncreaseMinGenerations:2,volumeVial:12,pump1StockDrugConcentration:0,pump2StockDrugConcentration:100},updaterSettings_bounds:{doseInitialization:[0,10,.1],odDilutionThreshold:[0,1,.01],dilutionFactor:[1,3,.1],dilutionNumberFirstDrugAddition:[0,10,1],doseFirstDrugAddition:[0,10,.1],doseIncreaseFactor:[1,5,.1],doseIncreaseAmount:[0,10,.1],thresholdOdMinIncreaseStress:[0,1,.01],thresholdGrowthRateIncreaseStress:[0,1,.01],thresholdGrowthRateDecreaseStress:[-1,0,.01],delayDilutionMaxHours:[1,24,1],delayStressIncreaseMinGenerations:[1,10,1],volumeVial:[1,20,.1],pump1StockDrugConcentration:[0,100,1],pump2StockDrugConcentration:[0,500,1]},modelSettings:{initialPopulation:.05,doublingTimeMins:20,carryingCapacity:.9,muMin:-.1,ic50Initial:5,ic10Ic50Ratio:.5,doseEffectiveSlopeWidthMins:120,timeLagDrugEffectMins:30,adaptationRateMax:.08,adaptationRateIc10Ic50Ratio:.8,timeCurrent:new Date},volumeUsed:0,totalTime:0,ic50FoldChange:0,volumePerIC50Doubling:0,timePerIC50Doubling:0,simulationHours:48,modelSettingsKeys:["initialPopulation","doublingTimeMins","carryingCapacity","muMin","ic50Initial","ic10Ic50Ratio","doseEffectiveSlopeWidthMins","timeLagDrugEffectMins","adaptationRateMax","adaptationRateIc10Ic50Ratio"],selectedTimepoint:0,maxTimepoints:0,isPlaying:!1,playInterval:null}},watch:{selectedTimepoint:"getParametersAtTimepoint",updaterSettings:{handler:"runSimulation",deep:!0},modelSettings:{handler:"runSimulation",deep:!0}},mounted(){this.runSimulation()},methods:{runSimulation(){const t=new F(this.updaterSettings);this.model=new G({...this.modelSettings,updater:t}),this.model.simulateExperiment(this.simulationHours),this.plotModelSimulation(this.model,this.simulationHours);let[e,i,n]=this.model.getSimulationEfficiency();const a=e/Math.log2(n),o=i/Math.log2(n);this.volumeUsed=e.toFixed(1),this.totalTime=i.toFixed(1),this.ic50FoldChange=n.toFixed(2),this.volumePerIC50Doubling=a.toFixed(1),this.timePerIC50Doubling=o.toFixed(1);const s=new z(this.model);s.plot_mu(),s.plot_adaptation_rate(),this.maxTimepoints=Math.min(this.model.population.length,this.model.ic50s.length,this.model.effectiveDoses.length,this.model.effectiveGrowthRates.length,this.model.adaptationRates.length)-1},getParametersAtTimepoint(){console.log("Selected timepoint:",this.selectedTimepoint),this.selectedTimepoint>this.maxTimepoints&&(console.log("Selected timepoint is out of bounds:",this.selectedTimepoint),this.selectedTimepoint=this.maxTimepoints);const t=this.selectedTimepoint,e={population:this.model.population[t][0],currentDose:this.model.effectiveDoses[t][0],IC50:this.model.ic50s[t][0],growthRate:this.model.effectiveGrowthRates[t][0],adaptationRate:this.model.adaptationRates[t][0],IC50_initial:this.model.ic50s[0][0]};return this.$emit("update-params",e),e},plotModelSimulation(t){const e=t.population.map((t=>t[1])),i=t.population.map((t=>t[0])),n=t.effectiveGrowthRates.map((t=>({x:t[1],y:t[0]}))),a=t.ic50s.map((t=>({x:t[1],y:t[0]}))),o=t.doses.map((t=>({x:t[1],y:t[0]}))),s=t.adaptationRates.map((t=>({x:t[1],y:t[0]}))),r=t.generations.map((t=>({x:t[1],y:t[0]}))),l={x:e,y:i,mode:"markers",name:"Bacteria Population",marker:{color:"black",size:5}},u={x:n.map((t=>t.x)),y:n.map((t=>t.y)),mode:"lines+markers",name:"Effective Growth Rate",yaxis:"y2",line:{color:"blue"}},h={x:a.map((t=>t.x)),y:a.map((t=>t.y)),mode:"lines",name:"IC50",yaxis:"y4",line:{color:"green",width:1,dash:"dot"}},d={x:o.map((t=>t.x)),y:o.map((t=>t.y)),mode:"lines+markers",name:"Dose",yaxis:"y4",line:{color:"green",shape:"hv",width:2}},m={x:t.effectiveDoses.map((t=>t[1])),y:t.effectiveDoses.map((t=>t[0])),mode:"lines",name:"Effective Dose",yaxis:"y4",line:{color:"green",width:1}},c={x:s.map((t=>t.x)),y:s.map((t=>t.y)),mode:"lines",name:"Adaptation Rate",yaxis:"y5",line:{color:"violet"}},p={x:r.map((t=>t.x)),y:r.map((t=>t.y)),mode:"lines+markers",name:"Generations",yaxis:"y6",line:{color:"red"}},g={title:"",xaxis:{title:"Time"},yaxis:{title:"Optical Density"},yaxis2:{title:"Effective Growth Rate",overlaying:"y",side:"right"},yaxis4:{title:"Dose",overlaying:"y",side:"right",position:.9},yaxis5:{title:"Adaptation Rate",overlaying:"y",side:"right",position:.85},yaxis6:{title:"Generations",overlaying:"y",side:"right",position:.8}},f=[l,u,h,d,m,c,p];$().newPlot("plotDiv",f,g).then((()=>{})).catch((t=>{console.error("Error in plotSimulation:",t)}))},togglePlay(){this.isPlaying?clearInterval(this.playInterval):this.playInterval=setInterval((()=>{this.selectedTimepoint=parseInt(this.selectedTimepoint),this.selectedTimepoint<this.maxTimepoints-4?this.selectedTimepoint+=4:this.selectedTimepoint=0}),.1),this.isPlaying=!this.isPlaying}}},V=i(6262);const N=(0,V.A)(O,[["render",R]]);var j=N;const H={class:"bact-wrapper"};function U(t,e,i,n,o,r){return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("div",{class:"animation-wrapper",style:(0,s.Tr)({backgroundColor:r.backgroundColor})},[(0,a.Lk)("div",H,[(0,a.Lk)("div",{ref:"bactAnimationContainer",style:(0,s.Tr)({width:`${o.animationSize}px`,height:`${o.animationSize}px`}),class:"lottie-animation"},null,4),(0,a.Lk)("div",{ref:"dnaAnimationContainer",style:(0,s.Tr)({width:`${o.animationSize}px`,height:`${o.animationSize}px`}),class:"lottie-animation dna-overlay"},null,4),(0,a.Lk)("div",{ref:"hammerAnimationContainer",style:(0,s.Tr)({width:`${o.animationSize}px`,height:`${o.animationSize}px`}),class:"lottie-animation hammer-overlay"},null,4),(0,a.Lk)("div",{ref:"shieldAnimationContainer",style:(0,s.Tr)({width:`${o.animationSize}px`,height:`${o.animationSize}px`,transform:`scaleX(-1) translateY(50px) translateX(-200px) scale(${o.shieldSize})`,opacity:o.shieldOpacity}),class:"lottie-animation shield-overlay"},null,4)]),(0,a.Lk)("div",{class:"death-wrapper",style:(0,s.Tr)({width:`${o.animationSize}px`,height:`${o.animationSize}px`,transform:"translateX(300px)"})},[(0,a.Lk)("div",{ref:"deathAnimationContainer",style:(0,s.Tr)({width:`${o.animationSize}px`,height:`${o.animationSize}px`,transform:`translateX(${o.deathPosition}px) scale(${o.deathScale})`}),class:"lottie-animation death-overlay"},null,4)],4)],4)])}var W=i(9891),X=i.n(W),B={name:"LottieAnimation",props:{IC50:{type:Number,default:4},IC50_initial:{type:Number,default:5},growthRate:{type:Number,default:1},adaptationRate:{type:Number,default:.005},currentDose:{type:Number,default:0}},data(){return{bactPath:"/replifactory_simulate/bact.json",dnaPath:"/replifactory_simulate/DNA3.json",hammerPath:"/replifactory_simulate/hammer2.json",shieldPath:"/replifactory_simulate/shield.json",shieldSize:0,shieldOpacity:.7,deathPath:"/replifactory_simulate/death.json",deathDistance:1,deathPosition:900,animationSize:800,backgroundShade:0,deathScale:1}},computed:{backgroundColor(){return`rgb(255, ${255-this.backgroundShade},  ${255-this.backgroundShade})`}},watch:{IC50:"updateShieldProperties",growthRate:"updateGrowthRate",adaptationRate:"updateAdaptation",currentDose:"updateBackgroundShade"},mounted(){this.loadAllAnimations().then((()=>{this.updateShieldProperties(this.IC50),this.updateGrowthRate(this.growthRate),this.updateAdaptation(this.adaptationRate),this.updateBackgroundShade(this.currentDose)}))},methods:{updateShieldProperties(t){const e=t/this.IC50_initial,i=1.5,n=.2,a=15,o=10,s=2,r=.9,l=.7;this.shieldSize=e<s?0:e<o?(e-s)*(i-n)/(o-s)+n:i,this.shieldOpacity=e<o?l:e<a?(e-o)*(r-l)/(a-o)+l:r},updateGrowthRate(t){const e=600,i=800,n=10*t/2;if(t<0){const n=-.1,a=0;this.animationSize=e+(t-n)*(i-e)/(a-n),this.bactAnimation.setSpeed(0)}else this.bactAnimation.setSpeed(n);this.deathPosition=t>.1?1200:t<-.1?0:600+6e3*t},updateAdaptation(t){const e=2,i=.1,n=.1,a=.01,o=Math.abs((t-a)/(n-a)),s=i+o*(e-i);this.dnaAnimation.setSpeed(s),t>a?(90===this.hammerAnimation.currentFrame&&this.hammerAnimation.playSegments([0,69],!0),this.hammerAnimation.setSpeed(s)):this.hammerAnimation.goToAndStop(90,!0)},updateBackgroundShade(t){this.backgroundShade=Math.round(t/100*255)},async loadGenericAnimation(t,e){const i=await fetch(t),n=await i.json();return X().loadAnimation({container:e,renderer:"svg",loop:!0,autoplay:!0,animationData:n})},async loadAllAnimations(){this.bactAnimation=await this.loadGenericAnimation(this.bactPath,this.$refs.bactAnimationContainer),this.dnaAnimation=await this.loadGenericAnimation(this.dnaPath,this.$refs.dnaAnimationContainer),this.hammerAnimation=await this.loadGenericAnimation(this.hammerPath,this.$refs.hammerAnimationContainer);const t=this.hammerAnimation.animationData;t.layers.splice(1,1),this.hammerAnimation.destroy(),this.hammerAnimation=X().loadAnimation({container:this.$refs.hammerAnimationContainer,renderer:"svg",loop:!0,autoplay:!0,animationData:t}),this.shieldAnimation=await this.loadGenericAnimation(this.shieldPath,this.$refs.shieldAnimationContainer);const e=this.shieldAnimation.animationData;e.layers.splice(3,1),e.layers.splice(4,1),e.layers.splice(5,1),this.shieldAnimation.destroy(),this.shieldAnimation=X().loadAnimation({container:this.$refs.shieldAnimationContainer,renderer:"svg",loop:!0,autoplay:!0,animationData:e}),this.deathAnimation=await this.loadGenericAnimation(this.deathPath,this.$refs.deathAnimationContainer);const i=this.deathAnimation.animationData;i.layers.splice(39,1),this.deathAnimation.destroy(),this.deathAnimation=X().loadAnimation({container:this.$refs.deathAnimationContainer,renderer:"svg",loop:!0,autoplay:!0,animationData:i})}}};const K=(0,V.A)(B,[["render",U],["__scopeId","data-v-a5a169c6"]]);var J=K,Y={name:"App",components:{SimulationControls:j,AnimatedBacteria:J},data(){return{animationParams:{IC50:5,IC50_initial:5,growthRate:1,adaptationRate:.005,currentDose:0}}},methods:{updateParams(t){console.log(t),this.animationParams={...this.animationParams,...t}}}};const q=(0,V.A)(Y,[["render",o]]);var Q=q;(0,n.Ef)(Q).mount("#app")}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.m=t,function(){i.amdO={}}(),function(){var t=[];i.O=function(e,n,a,o){if(!n){var s=1/0;for(h=0;h<t.length;h++){n=t[h][0],a=t[h][1],o=t[h][2];for(var r=!0,l=0;l<n.length;l++)(!1&o||s>=o)&&Object.keys(i.O).every((function(t){return i.O[t](n[l])}))?n.splice(l--,1):(r=!1,o<s&&(s=o));if(r){t.splice(h--,1);var u=a();void 0!==u&&(e=u)}}return e}o=o||0;for(var h=t.length;h>0&&t[h-1][2]>o;h--)t[h]=t[h-1];t[h]=[n,a,o]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var a,o,s=n[0],r=n[1],l=n[2],u=0;if(s.some((function(e){return 0!==t[e]}))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(l)var h=l(i)}for(e&&e(n);u<s.length;u++)o=s[u],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(h)},n=self["webpackChunksimulation"]=self["webpackChunksimulation"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=i.O(void 0,[504],(function(){return i(2185)}));n=i.O(n)})();
//# sourceMappingURL=app.eeeb8c27.js.map